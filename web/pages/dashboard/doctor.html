<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel del Doctor ‚Äî VetCare</title>
  <link rel="stylesheet" href="../../assets/css/auth.css" />
  <link rel="stylesheet" href="../../assets/css/style.css" />
  <style>
    .dashboard {
      max-width: 960px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card), var(--card-2));
      box-shadow: var(--shadow);
    }
    .dashboard h1 { margin-top: 0; }
    .cards { display: grid; gap: 16px; margin-top: 20px; }
    .card {
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: #e1d6c8;
    }
  </style>
</head>

<body>
  <header>
    <div class="container nav">
      <a class="brand" href="../dashboard/doctor.html" aria-label="Inicio">
        <span aria-hidden="true" class="logo"></span>
        <span class="name"><b>PawHospital</b></span>
      </a>

      <nav class="menu" aria-label="Navegaci√≥n principal">
        <a href="index-user.html#especialidad"></a>
        <a href="index-user.html#doctores"></a>
        <a href="index-user.html#sobre"></a>
        <a href="index-user.html#contacto"></a>
      </nav>

      <div class="user">
        <button class="trigger" type="button" aria-haspopup="dialog" aria-expanded="false">
          <span class="avatar" aria-hidden="true"></span>
          <span>Cuenta</span>
          <span class="chev" aria-hidden="true">‚ñæ</span>
        </button>

        <div class="panel" role="dialog" aria-label="Opciones de cuenta">
          <table class="mini-table">
            <thead>
              <tr><th colspan="2">Cuenta (Doctor)</th></tr>
            </thead>
            <tfoot>
              <tr>
                <td colspan="2"><a class="btn" href="../../pages/auth/login.html">Cerrar sesi√≥n</a></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </header>

  <main class="auth-shell">
    <section class="dashboard">
      <h1>üë®‚Äç‚öïÔ∏è Panel del Doctor</h1>
      <p class="p-muted">Bienvenido, aqu√≠ ver√°s un resumen r√°pido de tu agenda y pacientes.</p>

      <div class="cards">
        <div class="card">
          <h2>Citas de hoy</h2>
          <ul>
            <li>10:00 ‚Äî Max (Perro) ‚Äî Consulta general</li>
            <li>12:30 ‚Äî Luna (Gato) ‚Äî Control postoperatorio</li>
            <li>16:00 ‚Äî Rocky (Perro) ‚Äî Vacunaci√≥n</li>
          </ul>
        </div>

        <div class="card">
          <h2>Mensajes</h2>
          <p>No tienes mensajes nuevos.</p>
        </div>

        <!-- ‚úÖ ACCIONES R√ÅPIDAS (AQU√ç FALTABA btnNota) -->
        <div class="card">
          <h2>Acciones r√°pidas</h2>
          <button id="btnNota" class="btn btn--primary" type="button">Agregar receta / nota m√©dica</button>
          <button class="btn btn--ghost" type="button">Ver historial de pacientes</button>
        </div>

        <!-- ‚úÖ FORMULARIO (sin IDs duplicados) -->
        <div class="card" id="notaMedica" style="display:none; margin-top:20px;">
          <h2>Nueva receta / nota m√©dica</h2>

          <label for="medicamento">Medicamento</label>
          <select id="medicamento">
            <option value="">Cargando medicamentos...</option>
          </select>

          <div id="medInfo" style="margin:10px 0; padding:10px; border-radius:10px; background:#e3c89a;">
            <p style="margin:0; opacity:.85;">Selecciona un medicamento para ver sus datos.</p>
          </div>

          <label for="categoria">Categor√≠a</label>
          <select id="categoria">
            <option value="">Cargando categor√≠as...</option>
          </select>

          <label for="nota">Indicaciones / Nota</label>
          <textarea id="nota" rows="4" placeholder="Ej. 1 tableta cada 12h por 5 d√≠as"></textarea>

          <button id="btnGuardar" class="btn btn--primary" type="button">Guardar</button>
        </div>

        <div style="margin-top:20px;text-align:center">
          <a href="../../pages/auth/login.html" class="btn btn--link">Cerrar sesi√≥n</a>
        </div>
      </div>
    </section>
  </main>

  <script>
    const API = "http://localhost:3000";

    const btnNota = document.getElementById("btnNota");
    const notaMedica = document.getElementById("notaMedica");

    const selCategoria = document.getElementById("categoria");
    const selMedicamento = document.getElementById("medicamento");
    const medInfo = document.getElementById("medInfo");

    btnNota.addEventListener("click", () => {
      // toggle
      notaMedica.style.display = (notaMedica.style.display === "none") ? "block" : "none";
    });

    // Cargar categor√≠as
    fetch(`${API}/categorias`)
      .then(r => r.json())
      .then(data => {
        selCategoria.innerHTML = `<option value="">Selecciona una categor√≠a</option>`;
        data.forEach(cat => {
          const opt = document.createElement("option");
          opt.value = cat.id_cat;
          opt.textContent = cat.nom_cat;
          selCategoria.appendChild(opt);
        });
      })
      .catch(err => {
        console.error("Error categor√≠as:", err);
        selCategoria.innerHTML = `<option value="">Error cargando categor√≠as</option>`;
      });

    // Cargar medicamentos (lista)
    fetch(`${API}/medicamentos`)
      .then(r => r.json())
      .then(data => {
        selMedicamento.innerHTML = `<option value="">Selecciona un medicamento</option>`;
        data.forEach(m => {
          const opt = document.createElement("option");
          opt.value = m.id_med;
          opt.textContent = `${m.id_med} - ${m.nom_med}`;
          selMedicamento.appendChild(opt);
        });
      })
      .catch(err => {
        console.error("Error medicamentos:", err);
        selMedicamento.innerHTML = `<option value="">Error cargando medicamentos</option>`;
      });

    // Al elegir medicamento -> detalle
    selMedicamento.addEventListener("change", () => {
      const id = selMedicamento.value;

      if (!id) {
        medInfo.innerHTML = `<p style="margin:0; opacity:.85;">Selecciona un medicamento para ver sus datos.</p>`;
        return;
      }

      fetch(`${API}/medicamentos/${id}`)
        .then(r => r.json())
        .then(m => {
          if (m.error) {
            medInfo.innerHTML = `<p style="margin:0;">Error: ${m.error}</p>`;
            return;
          }

          medInfo.innerHTML = `
            <div style="display:grid; gap:6px;">
              <div><b>Medicamento:</b> ${m.nom_med} (ID ${m.id_med})</div>
              <div><b>Laboratorio:</b> ${m.nom_lab || "‚Äî"} (ID ${m.id_lab ?? "‚Äî"})</div>
              <div><b>V√≠a:</b> ${m.nom_via || "‚Äî"} (ID ${m.id_via ?? "‚Äî"})</div>
              <div><b>Categor√≠a:</b> ${m.nom_cat || "‚Äî"} (ID ${m.id_cat ?? "‚Äî"})</div>
              <div><b>Especie:</b> ${m.nom_especie || "‚Äî"} (ID ${m.id_especie ?? "‚Äî"})</div>
            </div>
          `;
        })
        .catch(err => {
          console.error("Error detalle medicamento:", err);
          medInfo.innerHTML = `<p style="margin:0;">Error cargando datos del medicamento</p>`;
        });
    });

    // Guardar (demo)
    document.getElementById("btnGuardar").addEventListener("click", () => {
      alert("Guardado (demo). Despu√©s lo conectamos a la BD.");
    });
  </script>
</body>
</html>
